<!DOCTYPE html> <html lang=en style><!--
 Page saved with SingleFile
 url: https://lwn.net/Articles/531381/
--><meta charset=utf-8><title>Namespaces in operation, part 2: the namespaces API [LWN.net]</title>
<meta name=viewport content="width=device-width, initial-scale=1">
<link rel=alternate type=application/rss+xml title="LWN.net headlines" href=https://lwn.net/headlines/rss>
<link rel=alternate type=application/rss+xml title="Comments posted to this article" href=https://lwn.net/headlines/531381/>
<style>body{color:black;background-color:#ffffff;padding:0px}h1{margin:0px 0px 5px 0px;padding:0px;color:black}h3{margin:0px 0px 5px 0px;padding:0px}a{text-decoration:underline}a:link{color:DarkBlue}a:visited{color:#444}a:hover{color:DarkBlue;background-color:#eeeeee}a:visited:hover{color:#444}DIV.PageHeadline{text-align:center;max-width:65em;margin-top:1em;margin-bottom:2em}DIV.PageHeadline H1{margin-bottom:0.2em}DETAILS.CommentBox{border-style:none none none solid;border-width:thin;max-width:65em;margin-top:1em;background-color:inherit;padding-left:8px}DETAILS.CommentBox>SUMMARY>H3.CommentTitle{background-color:#ffcc99}DETAILS.CommentBox{border-color:#ffcc99}H3.CommentTitle{display:inline-block;width:100%;padding-left:3px}DETAILS[open]>SUMMARY{list-style-type:none;opacity:1.0;cursor:zoom-out}DETAILS>SUMMARY>.CommentTitle::before{margin-right:4px;content:"[+]"}DETAILS[open]>SUMMARY>.CommentTitle::before{margin-right:4px;content:"[–]"}DETAILS>SUMMARY::MARKER,DETAILS>SUMMARY::-webkit-details-marker{display:none}P.CommentPoster{margin-top:0px}div.CommentReplyButton{display:block;text-align:right;padding:4px}TABLE.IndexEntries{background-color:#eeeeee;padding:3px;margin:5px;float:right}TABLE.IndexEntries TD:first-child{padding:1px 5px 1px 1px}SPAN.ReallySmall{font-size:x-small}DIV.FeatureByline{max-width:20em;float:left;background-color:#eeeeee;margin:2px 5px 2px 0px;padding-bottom:5px;padding-right:25px;padding-left:5px}DIV.ArticleText{margin:0px 0px 0px 0px;padding:0px 2px 0px 0px;max-width:65em}input{font-family:inherit;font-size:inherit}FONT.QuotedText{color:#990099}#menu{width:100%;position:fixed;top:0;left:0;right:0;background-color:#eeeeee;padding:0 0.2em 0 0.2em;overflow-y:visible;display:block;z-index:20;height:42px}DIV.navmenu-container{margin-left:0.5em;margin-top:0.5em;min-width:70%;border-radius:0.8em;padding:0.1em;display:inline-block}ul.navmenu{list-style:none;position:relative;display:inline-table;padding:0;margin:0}.navmenu li{display:inline-block;margin-right:0.4em}.navmenu ul{display:none;position:absolute;top:100%;width:15em;list-style:none;z-index:10;background:#eeeeee;padding-left:0;margin-left:0;border-style:solid}.navmenu ul li{display:block;margin-top:0.2em;margin-left:0.2em;line-height:1.4}.navmenu ul li:first-child{margin-top:1.2em}.navmenu li:hover>ul{display:block}a.navmenu{color:black}.navmenu a{text-decoration:none}.navmenu a:hover{text-decoration:underline}.navmenu a:visited,.topnav-container a:visited{color:DarkBlue}a.navmenu::after{content:" ▶"}span.logo,span.logobl,img.logo{display:none}DIV.topnav-container{margin-left:0.5em;margin-top:45px;margin-right:0.5em;background:#eeeeee;border-radius:0.8em;padding:0.3em}div.flexcol{display:flex;flex-direction:column}div.middlecolumn{flex:5}div.rightcol{padding-top:5em;flex:0 1 content}@media screen and (min-width:48em){.rightcol{flex:0;min-width:120px}}@media screen and (min-width:120em){.rightcol{max-width:400px}}@media screen and (min-width:48em){div.maincolumn{padding-left:10em}div.flexcol{flex-direction:row}#menu{display:block;width:9.6em;height:100%;bottom:0;overflow-y:visible}#menu:hover{overflow-y:auto}div.navmenu-container{display:block;margin-top:120px;margin-left:0;padding:0}.navmenu ul{display:block;position:static;width:9.6em;border-style:none;top:0}.navmenu li{margin:0.5em 0 0 0.1em;width:100%}.navmenu ul li{margin:0.1em 0 0 0.5em;text-indent:-0.4em;padding-right:0;width:auto;line-height:1.2}.navmenu ul li:first-child{margin-top:0}a.navmenu::after{content:""}DIV.topnav-container{margin-left:10.5em;margin-top:0.5em}img.logo{padding-right:0.2em;display:inline;float:left;position:absolute;top:3px;left:3px}span.logo{font-weight:bold;color:green;display:inline;font-size:180%;text-align:right;float:left;padding-left:60px;font-family:sans-serif;line-height:0.8;padding-top:0.3em}span.logobl{color:green;display:inline;font-size:80%;text-align:center;position:absolute;top:85px;left:5px;font-family:sans-serif}}@media screen and (min-width:80em){}@media (max-width:48em){.not-handset{display:none}}@media (min-width:48em){.not-handset{display:inline-block}}DIV.ArticleText{padding-left:0.5em}TABLE{border-collapse:separate;border-spacing:5px 0px}PRE{white-space:pre;overflow:visible}H3.CommentTitle{border-radius:0 2em 2em 0}html{font-family:inherit}input{background-color:#ffffff;color:black;padding:3px;border-radius:0.5em}input:focus{border-color:DarkBlue}input[type="submit"]{background-color:#eeeeee}input[type="submit"]:hover{background-color:#ccc}form.loginform{display:inline}TT{white-space:nowrap}</style>
<meta name=referrer content=no-referrer><link rel=icon href="data:image/png;base64,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" type=image/png><style>.sf-hidden{display:none!important}</style><link rel=canonical href=https://lwn.net/Articles/531381/><meta http-equiv=content-security-policy content="default-src 'none'; font-src 'self' data:; img-src 'self' data:; style-src 'unsafe-inline'; media-src 'self' data:; script-src 'unsafe-inline' data:; object-src 'self' data:; frame-src 'self' data:;"><style>img[src="data:,"],source[src="data:,"]{display:none!important}</style></head>
 <body>
 <a name=t></a>
<div id=menu><a href=https://lwn.net/><img src=data:image/png;base64,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 class=logo border=0 alt="LWN.net Logo">
 <span class=logo>LWN<br>.net</span>
 <span class=logobl>News from the source</span></a>
 <a href=https://lwn.net/><img src=data:, class="sslogo sf-hidden" border=0 alt=LWN></a><div class=navmenu-container>
 <ul class=navmenu>
 <li><a class=navmenu href=#t><b>Content</b></a><ul><li><a href=https://lwn.net/current/>Weekly Edition</a><li><a href=https://lwn.net/Archives/>Archives</a><li><a href=https://lwn.net/Search/>Search</a><li><a href=https://lwn.net/Kernel/>Kernel</a><li><a href=https://lwn.net/Security/>Security</a><li><a href=https://lwn.net/Calendar/>Events calendar</a><li><a href=https://lwn.net/Comments/unread>Unread comments</a><li><hr><li><a href=https://lwn.net/op/FAQ.lwn>LWN FAQ</a><li><a href=https://lwn.net/op/AuthorGuide.lwn>Write for us</a></ul></li>
<li><a class=navmenu href=#t><b>Edition</b></a><ul><li><a href=https://lwn.net/Articles/531498/>Return to the Development page</a></ul></li>
</ul></div>
</div>
<div class=not-handset style=margin-left:10.5em;display:block>
 <div class=not-print> <div id=azk13321_leaderboard></div> </div>
 </div>
 <div class=topnav-container>
<div class=not-handset><form action=https://lwn.net/Login/ method=post name=loginform class=loginform>
 <label><b>User:</b> <input type=text name=Username value size=8 id=uc></label>
 <label><b>Password:</b> <input type=password name=Password size=8 id=pc value></label> <input type=submit name=submit value="Log in"></form> |
 <form action=https://lwn.net/subscribe/ method=post class=loginform>
 <input type=submit name=submit value=Subscribe>
 </form> |
 <form action=https://lwn.net/Login/newaccount method=post class=loginform>
 <input type=submit name=submit value=Register>
 </form>
 </div>
 <div class="handset-only sf-hidden">
 /
 /

 </div>
 </div><div class="maincolumn flexcol">
<div class=middlecolumn>
<div class=PageHeadline>
<h1>Namespaces in operation, part 2: the namespaces API</h1>
</div>
<div class=ArticleText>
<div class=FeatureByline>
 By <b>Michael Kerrisk</b><br>January 8, 2013
 </div>
<p> A namespace wraps a global system resource in an abstraction that makes
it appear to the processes within the namespace that they have their own
isolated instance of the resource. Namespaces are used for a
variety of purposes, with the most notable being the implementation of <a href=https://lwn.net/Articles/524952/>containers</a>, a technique for lightweight
virtualization. This is the second part in a series of articles that looks
in some detail at namespaces and the namespaces API. The
<a href=https://lwn.net/Articles/531114/>first article</a> in this series provided an
overview of namespaces. This article looks at
the namespaces API in some detail and shows the API in
action in a number of example programs.
<p> The namespace API consists of three system
calls—<tt>clone()</tt>, <tt>unshare()</tt>, and
<tt>setns()</tt>—and a number of <tt>/proc</tt> files. In this
article, we'll look at all of these system calls and some of the
<tt>/proc</tt> files. In order to specify a namespace type on which to
operate, the three system calls make use of the <tt>CLONE_NEW*</tt>
constants listed in the previous article:
<tt>CLONE_NEWIPC</tt>,
<tt>CLONE_NEWNS</tt>,
<tt>CLONE_NEWNET</tt>,
<tt>CLONE_NEWPID</tt>,
<tt>CLONE_NEWUSER</tt>, and
<tt>CLONE_NEWUTS</tt>.
<h4>Creating a child in a new namespace: clone()</h4>
<p>One way of creating a namespace is via the use of <a href=http://man7.org/linux/man-pages/man2/clone.2.html><tt>clone()</tt></a>,
a system call that creates a new process. For our purposes,
<tt>clone()</tt> has the following prototype:
<pre>    int clone(int (*child_func)(void *), void *child_stack, int flags, void *arg);
</pre>
<p> Essentially, <tt>clone()</tt> is a more general version of the
traditional UNIX <tt>fork()</tt> system call whose functionality can be
controlled via the <tt>flags</tt> argument. In all, there are more than
twenty different <tt>CLONE_*</tt> flags that control various aspects of the
operation of <tt>clone()</tt>, including whether the parent and child
process share resources such as virtual memory, open file descriptors, and
signal dispositions. If one of the <tt>CLONE_NEW*</tt> bits is specified
in the call, then a new namespace of the corresponding type is created, and
the new process is made a member of that namespace; multiple
<tt>CLONE_NEW*</tt> bits can be specified in <tt>flags</tt>.
<p> Our example program (<tt>demo_uts_namespace.c</tt>) uses
<tt>clone()</tt> with the <tt>CLONE_NEWUTS</tt> flag to create a UTS
namespace. As we saw last week, UTS namespaces isolate two system
identifiers—the hostname and the NIS domain name—that are set
using the <tt>sethostname()</tt> and <tt>setdomainname()</tt> system calls
and returned by the <tt>uname()</tt> system call. You can find the full
source of the program <a href=https://lwn.net/Articles/531245/>here</a>. Below, we'll
focus on just some of the key pieces of the program (and for brevity, we'll
omit the error checking code that is present in the full version of the
program).
<p> The example program takes one command-line argument. When run, it
creates a child that executes in a new UTS namespace. Inside that
namespace, the child changes the hostname to the string given as the
program's command-line argument.
<p> The first significant piece of the main program is the <tt>clone()</tt>
call that creates the child process:
<pre>    child_pid = clone(childFunc,
                      child_stack + STACK_SIZE,   /* Points to start of
                                                     downwardly growing stack */
                      CLONE_NEWUTS | SIGCHLD, argv[1]);

    printf("PID of child created by clone() is %ld\n", (long) child_pid);
</pre>
<p> The new child will begin execution in the user-defined function
<tt>childFunc()</tt>; that function will receive the final <tt>clone()</tt>
argument (<tt>argv[1]</tt>) as its argument. Since <tt>CLONE_NEWUTS</tt>
is specified as part of the <tt>flags</tt> argument, the child will execute
in a newly created UTS namespace.
<p> The main program then sleeps for a moment. This is a (crude) way of
giving the child time to change the hostname in its UTS namespace. The
program then uses <tt>uname()</tt> to retrieve the host name in the
parent's UTS namespace, and displays that hostname:
<pre>    sleep(1);           /* Give child time to change its hostname */

    uname(&amp;uts);
    printf("uts.nodename in parent: %s\n", uts.nodename);
</pre>
<p> Meanwhile, the <tt>childFunc()</tt> function executed by the child
created by <tt>clone()</tt> first changes the hostname to the value
supplied in its argument, and then retrieves and displays the modified
hostname:
<pre>    sethostname(arg, strlen(arg);

    uname(&amp;uts);
    printf("uts.nodename in child:  %s\n", uts.nodename);
</pre>
<p> Before terminating, the child sleeps for a while. This has the effect
of keeping the child's UTS namespace open, and gives us a chance to conduct
some of the experiments that we show later.
<p> Running the program demonstrates that the parent and child processes
have independent UTS namespaces:
<pre>    $ <b>su</b>                   # Need privilege to create a UTS namespace
    Password:
    # <b>uname -n</b>
    antero
    # <b>./demo_uts_namespaces bizarro</b>
    PID of child created by clone() is 27514
    uts.nodename in child:  bizarro
    uts.nodename in parent: antero
</pre>
<p> As with most other namespaces (user namespaces are the exception),
creating a UTS namespace requires privilege (specifically,
<tt>CAP_SYS_ADMIN</tt>). This is necessary to avoid scenarios where
set-user-ID applications could be fooled into doing the wrong thing because the
system has an unexpected hostname.
<p>Another possibility is that a set-user-ID application might be using the
hostname as part of the name of a lock file. If an unprivileged user could
run the application in a UTS namespace with an arbitrary hostname, this
would open the application to various attacks. Most simply, this would
nullify the effect of the lock file, triggering misbehavior in instances of
the application that run in different UTS namespaces. Alternatively, a
malicious user could run a set-user-ID application in a UTS namespace with
a hostname that causes creation of the lock file to overwrite an important
file. (Hostname strings can contain arbitrary characters, including
slashes.)
<a name=proc_pid_ns></a>
<h4>The <tt>/proc/</tt><i>PID</i><tt>/ns</tt> files</h4>
<p> Each process has a <tt>/proc/</tt><i>PID</i><tt>/ns</tt> directory that
contains one file for each type of namespace. Starting in Linux 3.8, each
of these files is a special symbolic link that provides a kind of handle
for performing certain operations on the associated namespace for the
process.
<pre>    $ <b>ls -l /proc/$$/ns</b>         # $$ is replaced by shell's PID
    total 0
    lrwxrwxrwx. 1 mtk mtk 0 Jan  8 04:12 ipc -&gt; ipc:[4026531839]
    lrwxrwxrwx. 1 mtk mtk 0 Jan  8 04:12 mnt -&gt; mnt:[4026531840]
    lrwxrwxrwx. 1 mtk mtk 0 Jan  8 04:12 net -&gt; net:[4026531956]
    lrwxrwxrwx. 1 mtk mtk 0 Jan  8 04:12 pid -&gt; pid:[4026531836]
    lrwxrwxrwx. 1 mtk mtk 0 Jan  8 04:12 user -&gt; user:[4026531837]
    lrwxrwxrwx. 1 mtk mtk 0 Jan  8 04:12 uts -&gt; uts:[4026531838]
</pre>
<p> One use of these symbolic links is to discover whether two processes
are in the same namespace. The kernel does some magic to ensure that if two
processes are in the same namespace, then the inode numbers reported for
the corresponding symbolic links in <tt>/proc/</tt><i>PID</i><tt>/ns</tt>
will be the same. The inode numbers can be obtained using the <a href=http://man7.org/linux/man-pages/man2/stat.2.html><tt>stat()</tt>
</a> system call (in the <tt>st_ino</tt> field of the returned structure).
<p> However, the kernel also constructs each of the
<tt>/proc/</tt><i>PID</i><tt>/ns</tt> symbolic links so that it points to a
name consisting of a string that identifies the namespace type, followed by
the inode number. We can examine this name using either the
<tt>ls&nbsp;-l</tt> or the <tt>readlink</tt> command.
<p> Let's return to the shell session above where we ran the
<tt>demo_uts_namespaces</tt> program. Looking at the
<tt>/proc/</tt><i>PID</i><tt>/ns</tt> symbolic links for the
parent and child process provides an alternative method of checking whether
the two processes are in the same or different UTS namespaces:
<pre>    <b>^Z</b>                                # Stop parent and child
    [1]+  Stopped          ./demo_uts_namespaces bizarro
    # <b>jobs -l</b>                         # Show PID of parent process
    [1]+ 27513 Stopped         ./demo_uts_namespaces bizarro
    # <b>readlink /proc/27513/ns/uts</b>     # Show parent UTS namespace
    uts:[4026531838]
    # <b>readlink /proc/27514/ns/uts</b>     # Show child UTS namespace
    uts:[4026532338]
</pre>
<p>
As can be seen, the content of the
<tt>/proc/</tt><i>PID</i><tt>/ns/uts</tt> symbolic links differs,
indicating that the two processes are in different UTS namespaces.
<p> The <tt>/proc/</tt><i>PID</i><tt>/ns</tt> symbolic links also serve
other purposes. If we open one of these files, then the namespace will
continue to exist as long as the file descriptor remains open, even if all
processes in the namespace terminate. The same effect can also be obtained
by bind mounting one of the symbolic links to another location in the file
system:
<pre>    # <b>touch ~/uts</b>                            # Create mount point
    # <b>mount --bind /proc/27514/ns/uts ~/uts</b>
</pre>
<p> Before Linux 3.8, the files in <tt>/proc/</tt><i>PID</i><tt>/ns</tt>
were hard links rather than special symbolic links of the form described
above. In addition, only the <tt>ipc</tt>, <tt>net</tt>, and <tt>uts</tt>
files were present.
<h4>Joining an existing namespace: setns()</h4>
<p> Keeping a namespace open when it contains no processes is of course
only useful if we intend to later add processes to it. That is the task of
the <a href=http://man7.org/linux/man-pages/man2/setns.2.html><tt>setns()</tt></a>
system call, which allows the calling process to join an existing
namespace:
<pre>    int setns(int fd, int nstype);
</pre>
<p> More precisely, <tt>setns()</tt> disassociates the calling process from
one instance of a particular namespace type and reassociates the process
with another instance of the same namespace type.
<p>
The
<tt>fd</tt> argument specifies the namespace to join; it is a file
descriptor that refers to one of the symbolic links in a
<tt>/proc/</tt><i>PID</i><tt>/ns</tt> directory. That file descriptor can
be obtained either by opening one of those symbolic links directly or by
opening a file that was bind mounted to one of the links.
<p> The <tt>nstype</tt> argument allows the caller to check the type of
namespace that <tt>fd</tt> refers to. If this argument is specified as
zero, no check is performed. This can be useful if the caller already
knows the namespace type, or does not care about the type. The example
program that we discuss in a moment (<tt>ns_exec.c</tt>) falls into the
latter category: it is designed to work with any namespace type.
Specifying <tt>nstype</tt> instead as one of the <tt>CLONE_NEW*</tt>
constants causes the kernel to verify that <tt>fd</tt> is a file descriptor
for the corresponding namespace type. This can be useful if, for example,
the caller was passed the file descriptor via a UNIX domain socket and
needs to verify what type of namespace it refers to.
<p> Using <tt>setns()</tt> and <tt>execve()</tt> (or one of the other
<tt>exec()</tt> functions) allows us to construct a simple but useful tool:
a program that joins a specified namespace and then executes a command in
that namespace.
<p> Our program (<tt>ns_exec.c</tt>, whose full source can be found <a href=https://lwn.net/Articles/531271/>here</a>) takes two or more command-line
arguments. The first argument is the pathname of a
<tt>/proc/</tt><i>PID</i><tt>/ns/*</tt> symbolic link (or a file that is
bind mounted to one of those symbolic links). The remaining arguments are
the name of a program to be executed inside the namespace that corresponds
to that symbolic link and optional command-line arguments to be given to
that program. The key steps in the program are the following:
<pre>    fd = open(argv[1], O_RDONLY);   /* Get descriptor for namespace */

    setns(fd, 0);                   /* Join that namespace */

    execvp(argv[2], &amp;argv[2]);      /* Execute a command in namespace */
</pre>
<p>
An interesting program to execute inside a namespace is, of course, a
shell. We can use the bind mount for the UTS namespace that we created
earlier in conjunction with the <tt>ns_exec</tt> program to execute a shell
in the new UTS namespace created by our invocation of
<tt>demo_uts_namespaces</tt>:
<pre>    # <b>./ns_exec ~/uts /bin/bash</b>     # ~/uts is bound to /proc/27514/ns/uts
    My PID is: 28788
</pre>
<p> We can then verify that the shell is in the same UTS namespace as the
child process created by <tt>demo_uts_namespaces</tt>, both by inspecting
the hostname and by comparing the inode numbers of the
<tt>/proc/</tt><i>PID</i><tt>/ns/uts</tt> files:
<pre>    # <b>hostname</b>
    bizarro
    # <b>readlink /proc/27514/ns/uts</b>
    uts:[4026532338]
    # <b>readlink /proc/$$/ns/uts</b>      # $$ is replaced by shell's PID
    uts:[4026532338]
</pre>
<p> In earlier kernel versions, it was not possible to use <tt>setns()</tt>
to join mount, PID, and user namespaces, but, starting with Linux 3.8,
<tt>setns()</tt> now supports joining all namespace types.
<h4>Leaving a namespace: unshare()</h4>
<p>
The final system call in the namespaces API is <a href=http://man7.org/linux/man-pages/man2/unshare.2.html><tt>unshare()</tt></a>:
<pre>    int unshare(int flags);
</pre>
<p> The <tt>unshare()</tt> system call provides functionality similar to
<tt>clone()</tt>, but operates on the calling process: it creates the new
namespaces specified by the <tt>CLONE_NEW*</tt> bits in its <tt>flags</tt>
argument and makes the caller a member of the namespaces. (As with
<tt>clone()</tt>, <tt>unshare()</tt> provides functionality beyond working
with namespaces that we'll ignore here.) The main purpose of
<tt>unshare()</tt> is to isolate namespace (and other) side effects without
having to create a new process or thread (as is done by <tt>clone()</tt>).
<p>
Leaving aside the other effects of the <tt>clone()</tt> system call,
a call of the form:
<pre>    clone(..., CLONE_NEWXXX, ....);
</pre>
<p>
is roughly equivalent, in namespace terms, to the sequence:
<pre>    if (fork() == 0)
        unshare(CLONE_NEWXXX);      /* Executed in the child process */
</pre>
<p> One use of the <tt>unshare()</tt> system call is in the implementation
of the <tt>unshare</tt> command, which allows the user to execute a command
in a separate namespace from the shell. The general form of this command
is:
<pre>    unshare [options] program [arguments]
</pre>
<p> The <tt>options</tt> are command-line flags that specify the namespaces
to unshare before executing <tt>program</tt> with the specified
<tt>arguments</tt>.
<p>
The key steps in the implementation of the <tt>unshare</tt> command are
straightforward:
<pre>     /* Code to initialize 'flags' according to command-line options
        omitted */

     unshare(flags);

     /* Now execute 'program' with 'arguments'; 'optind' is the index
        of the next command-line argument after options */

     execvp(argv[optind], &amp;argv[optind]);
</pre>
<p> A simple implementation of the <tt>unshare</tt> command
(<tt>unshare.c</tt>) can be found <a href=https://lwn.net/Articles/531826/>here</a>.
<p> In the following shell session, we use our <tt>unshare.c</tt> program to
execute a shell in a separate mount namespace. As we noted in last week's
article, mount namespaces isolate the set of filesystem mount points seen
by a group of processes, allowing processes in different mount namespaces
to have different views of the filesystem hierarchy.
<pre>    # <b>echo $$</b>                             # Show PID of shell
    8490
    # <b>cat /proc/8490/mounts | grep mq</b>     # Show one of the mounts in namespace
    mqueue /dev/mqueue mqueue rw,seclabel,relatime 0 0
    # <b>readlink /proc/8490/ns/mnt</b>          # Show mount namespace ID
    mnt:[4026531840]
    # <b>./unshare -m /bin/bash</b>              # Start new shell in separate mount namespace
    # <b>readlink /proc/$$/ns/mnt</b>            # Show mount namespace ID
    mnt:[4026532325]
</pre>
<p> Comparing the output of the two <tt>readlink</tt> commands shows that
the two shells are in separate mount namespaces. Altering the set of mount
points in one of the namespaces and checking whether that change is visible
in the other namespace provides another way of demonstrating that the two
programs are in separate namespaces:
<pre>    # <b>umount /dev/mqueue</b>                  # Remove a mount point in this shell
    # <b>cat /proc/$$/mounts | grep mq</b>       # Verify that mount point is gone
    # <b>cat /proc/8490/mounts | grep mq</b>     # Is it still present in the other namespace?
    mqueue /dev/mqueue mqueue rw,seclabel,relatime 0 0
</pre>
<p>
As can be seen from the output of the last two commands, the
<tt>/dev/mqueue</tt> mount point has disappeared in one mount namespace, but
continues to exist in the other.
<h4>Concluding remarks</h4>
<p> In this article we've looked at the fundamental pieces of the namespace
API and how they are employed together. In the follow-on articles, we'll look
in more depth at some other namespaces, in particular, the PID and user namespaces;
user namespaces open up a range of new possibilities for applications to use kernel
interfaces that were formerly restricted to privileged applications.
<p>
<i>(2013-01-15: updated the concluding remarks to reflect the fact that there will be more than one following article.)</i><br clear=all><table class=IndexEntries>
 <tbody><tr><th colspan=2>Index entries for this article</tr>
 <tr><td><a href=https://lwn.net/Kernel/Index>Kernel</a><td><a href=https://lwn.net/Kernel/Index#Namespaces>Namespaces</a></tr>
 <tr><td><a href=https://lwn.net/Kernel/Index>Kernel</a><td><a href=https://lwn.net/Kernel/Index#Namespaces-UTS_namespaces>Namespaces/UTS namespaces</a></tr>
 <tr><td><a href=https://lwn.net/Kernel/Index>Kernel</a><td><a href=https://lwn.net/Kernel/Index#System_calls-clone>System calls/clone()</a></tr>
 <tr><td><a href=https://lwn.net/Kernel/Index>Kernel</a><td><a href=https://lwn.net/Kernel/Index#System_calls-setns>System calls/setns()</a></tr>
 <tr><td><a href=https://lwn.net/Kernel/Index>Kernel</a><td><a href=https://lwn.net/Kernel/Index#System_calls-unshare>System calls/unshare()</a></tr>
 </table><br clear=all>
<hr width=60% align=left>
 (<a href="https://lwn.net/Login/?target=/Articles/531381/">Log in</a> to post comments)
 <p>

</p></div>
<p><a name=Comments></a>
<a name=CommAnchor531928></a>
 <details class=CommentBox open><template shadowrootmode=closed><slot name=internal-main-summary><summary>Details</summary></slot><slot></slot></template>
 <summary><h3 class=CommentTitle>Namespaces in operation, part 2: the namespaces API</h3>
 <p class=CommentPoster> Posted Jan 8, 2013 22:04 UTC (Tue)
 by <b>justincormack</b> (subscriber, #70439)
 [<a href=https://lwn.net/Articles/531928/>Link</a>] (3 responses)
 </p></summary>
 <div class=FormattedComment>
I have spent a fair amount of time with these interfaces, except the shiny new user namespace, so I am a bit confused by that. If you change to a new user ns and therefore become "root" what can you do? Is it affected by which other namespaces you are in? eg if you create a new user ns and new netns can you say use ping or other root-requiring network ops? I guess I should install a new kernel and experiment...<br>
<p>
</p></div>

 <div class=CommentReplyButton>
 <form action=/Articles/531928/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>

 <a name=CommAnchor531952></a>
 <details class=CommentBox open><template shadowrootmode=closed><slot name=internal-main-summary><summary>Details</summary></slot><slot></slot></template>
 <summary><h3 class=CommentTitle>Namespaces in operation, part 2: the namespaces API</h3>
 <p class=CommentPoster> Posted Jan 9, 2013 0:23 UTC (Wed)
 by <b>rvolgers</b> (guest, #63218)
 [<a href=https://lwn.net/Articles/531952/>Link</a>]
 </p></summary>
 <div class=FormattedComment>
Looking at the source a user namespace root user has all capabilities within that namespace, and raw socket access is controlled by a ns_capable(...) check, so it should be possible.<br>
<p>
I have not tested this, so take it with a grain of salt. <br>
</p></div>

 <div class=CommentReplyButton>
 <form action=/Articles/531952/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>

 </p></details>
<a name=CommAnchor531966></a>
 <details class=CommentBox open><template shadowrootmode=closed><slot name=internal-main-summary><summary>Details</summary></slot><slot></slot></template>
 <summary><h3 class=CommentTitle>Namespaces in operation, part 2: the namespaces API</h3>
 <p class=CommentPoster> Posted Jan 9, 2013 1:24 UTC (Wed)
 by <b>hallyn</b> (subscriber, #22558)
 [<a href=https://lwn.net/Articles/531966/>Link</a>] (1 responses)
 </p></summary>
 <div class=FormattedComment>
<font class=QuotedText>&gt; eg if you create a new user ns and new netns can you say use ping or other root-requiring network ops?</font><br>
<p>
Yes - but only with nics owned by your new network namespace. Which means nics which you create (which won't be hooked into the parent ns), or nics which a privileged task in the parent netns passed into your ns.<br>
<p>
</p></div>

 <div class=CommentReplyButton>
 <form action=/Articles/531966/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>

 <a name=CommAnchor532890></a>
 <details class=CommentBox open><template shadowrootmode=closed><slot name=internal-main-summary><summary>Details</summary></slot><slot></slot></template>
 <summary><h3 class=CommentTitle>Namespaces in operation, part 2: the namespaces API</h3>
 <p class=CommentPoster> Posted Jan 17, 2013 3:03 UTC (Thu)
 by <b>kevinm</b> (guest, #69913)
 [<a href=https://lwn.net/Articles/532890/>Link</a>]
 </p></summary>
 <div class=FormattedComment>
So with a VPN (or IPv6 tunnel) endpoint that uses TUN/TAP, you could bring up your VPN and pingflood away to your heart's content.<br>
</div>

 <div class=CommentReplyButton>
 <form action=/Articles/532890/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>

 </p></details>
</details>
</details>
<a name=CommAnchor532372></a>
 <details class=CommentBox open><template shadowrootmode=closed><slot name=internal-main-summary><summary>Details</summary></slot><slot></slot></template>
 <summary><h3 class=CommentTitle>Namespaces in operation, part 2: the namespaces API</h3>
 <p class=CommentPoster> Posted Jan 11, 2013 11:19 UTC (Fri)
 by <b>tpo</b> (subscriber, #25713)
 [<a href=https://lwn.net/Articles/532372/>Link</a>]
 </p></summary>
 <div class=FormattedComment>
What a wonderful article.<br>
<p>
It clearly and comprehensively explains the basics and the use in practice, is technical and easy to read.<br>
<p>
Thanks Michael!<br>
*t<br>
</p></div>

 <div class=CommentReplyButton>
 <form action=/Articles/532372/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>

 </p></details>
<a name=CommAnchor533162></a>
 <details class=CommentBox open><template shadowrootmode=closed><slot name=internal-main-summary><summary>Details</summary></slot><slot></slot></template>
 <summary><h3 class=CommentTitle>setns syscall via syscall()</h3>
 <p class=CommentPoster> Posted Jan 18, 2013 9:15 UTC (Fri)
 by <b>bourbaki</b> (guest, #84259)
 [<a href=https://lwn.net/Articles/533162/>Link</a>]
 </p></summary>
 <div class=FormattedComment>
If your libc is too old and and does not have the setns() wrapper for the sys_setns syscall, you can use the syscall() function instead (in &lt;sys/syscall.h&gt;).<br>
<p>
On x86_64, the sys_setns syscall number is 308, so in ns_exec.c you can do :<br>
<p>
syscall(308,fd,0)<br>
<p>
instead of<br>
<p>
setns(fd,0)<br>
</p></div>

 <div class=CommentReplyButton>
 <form action=/Articles/533162/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>

 </p></details>
<a name=CommAnchor548736></a>
 <details class=CommentBox open><template shadowrootmode=closed><slot name=internal-main-summary><summary>Details</summary></slot><slot></slot></template>
 <summary><h3 class=CommentTitle>Namespaces in operation, part 2: the namespaces API</h3>
 <p class=CommentPoster> Posted Apr 27, 2013 15:50 UTC (Sat)
 by <b>wkevils</b> (guest, #90640)
 [<a href=https://lwn.net/Articles/548736/>Link</a>] (1 responses)
 </p></summary>
 <div class=FormattedComment>
Did anybody tried the example with the mount namespaces ? <br>
<p>
I tried it both on Fedora 18 and Ubuntu 12.10 and it did not <br>
work.<br>
For Fedora 18, it could be because of the shared flags.<br>
(running cat /proc/$$/mountinfo show shared).<br>
<p>
But for ubuntu:<br>
 cat /proc/$$/mountinfo |grep shared<br>
gives nothing.<br>
<p>
I would appreciate if someone that tested it and it worked <br>
will post which OS and which kernel he uses.<br>
<p>
rgs<br>
Kevin Wilson<br>
<p>
<p>
</p></div>

 <div class=CommentReplyButton>
 <form action=/Articles/548736/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>

 <a name=CommAnchor548749></a>
 <details class=CommentBox open><template shadowrootmode=closed><slot name=internal-main-summary><summary>Details</summary></slot><slot></slot></template>
 <summary><h3 class=CommentTitle>Namespaces in operation, part 2: the namespaces API</h3>
 <p class=CommentPoster> Posted Apr 27, 2013 20:38 UTC (Sat)
 by <b>mathstuf</b> (subscriber, #69389)
 [<a href=https://lwn.net/Articles/548749/>Link</a>]
 </p></summary>
 <div class=FormattedComment>
Anything that ships with XFS enabled (pretty much any distro) can't support user namespaces yet since XFS won't work with them. You're probably stuck compiling your own for now (which is what I did and then tossed it into a VM).<br>
</div>

 <div class=CommentReplyButton>
 <form action=/Articles/548749/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>

 </p></details>
</details>
<a name=CommAnchor635251></a>
 <details class=CommentBox open><template shadowrootmode=closed><slot name=internal-main-summary><summary>Details</summary></slot><slot></slot></template>
 <summary><h3 class=CommentTitle>Namespaces in operation, part 2: the namespaces API</h3>
 <p class=CommentPoster> Posted Mar 2, 2015 12:08 UTC (Mon)
 by <b>mkerrisk</b> (subscriber, #1978)
 [<a href=https://lwn.net/Articles/635251/>Link</a>]
 </p></summary>
 One point to note regarding the <tt>unshare.c</tt> experiment with mount namespaces (shown toward the end of the article)... These days, some distributions (e.g., Fedora) enable mount event propagation (<i>mount --make-shared</i>) by default, so that an unmount in the second namespace would automatically affect the initial namespace as well. To prevent mount event propagation, we need to make / a private mount in the second namespace. See the following example:
<pre>$ <strong>echo $$</strong>      # Show PID of shell in initial mount NS
989
$ <strong>readlink /proc/989/ns/mnt</strong>
mnt:[4026531840]
$ <strong>cat /proc/989/mounts | awk '/test/ { print $1 , $2 , $3}'</strong>
/dev/sda3 /test ext4
$ <strong>PS1='$sh2 ' sudo ./unshare -m /bin/bash</strong>   # Start a new shell in a new mount NS
sh2$ <strong>readlink /proc/$$/ns/mnt</strong>       # Verify that shell is in different mount NS
mnt:[4026532640]
sh2$ # Check whether / mount point propagates mount events
sh2$ <strong>cat /proc/$$/mountinfo | awk '/\/ \/ / {print $4, $5, $6, $7}'</strong>
/ / rw,relatime <strong><font color=red>shared:1</font></strong>
sh2$ <strong>sudo mount --make-private /</strong>    # Prevent propagation of events for /
sh2$ <strong>cat /proc/$$/mountinfo | awk '/\/ \/ / {print $4, $5, $6, $7}'</strong>
/ / rw,relatime <strong><font color=red>-</font></strong>
sh2$ <strong>sudo umount /test</strong>              # Unmount /test in second mount NS
sh2$ Verify that mount has been removed in second mount NS
sh2$ <strong>cat /proc/$$/mounts | awk '/test/ { print $1 , $2 , $3}'</strong>
sh2$ Verify that mount is still present in initial mount NS
sh2$ <strong>cat /proc/989/mounts | awk '/test/ { print $1 , $2 ,$3}'</strong>
/dev/sda3 /test ext4
</pre>
For more info about mount propagation, see the kernel source file <tt>Documentation/filesystems/sharedsubtree.txt</tt> and the <tt>mount(8)</tt> man page.

 <div class=CommentReplyButton>
 <form action=/Articles/635251/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>

 </p></details>
<a name=CommAnchor635320></a>
 <details class=CommentBox open><template shadowrootmode=closed><slot name=internal-main-summary><summary>Details</summary></slot><slot></slot></template>
 <summary><h3 class=CommentTitle>Namespaces in operation, part 2: the namespaces API</h3>
 <p class=CommentPoster> Posted Mar 3, 2015 6:40 UTC (Tue)
 by <b>apollock</b> (subscriber, #14629)
 [<a href=https://lwn.net/Articles/635320/>Link</a>] (1 responses)
 </p></summary>
 <div class=FormattedComment>
I'm curious. If you bind mount the /proc/PID/ns/uts entry, and then the original process goes away, is that PID available for reuse?<br>
<p>
I presume the answer is yes, and the new /proc/PID just winds up with a completely unrelated inode from the old one.<br>
</p></div>

 <div class=CommentReplyButton>
 <form action=/Articles/635320/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>

 <a name=CommAnchor810938></a>
 <details class=CommentBox open><template shadowrootmode=closed><slot name=internal-main-summary><summary>Details</summary></slot><slot></slot></template>
 <summary><h3 class=CommentTitle>Namespaces in operation, part 2: the namespaces API</h3>
 <p class=CommentPoster> Posted Jan 30, 2020 1:09 UTC (Thu)
 by <b>mkerrisk</b> (subscriber, #1978)
 [<a href=https://lwn.net/Articles/810938/>Link</a>]
 </p></summary>
 <div class=FormattedComment>
<font class=QuotedText>&gt; I presume the answer is yes, and the new </font><br>
<font class=QuotedText>&gt; /proc/PID just winds up with a completely</font><br>
<font class=QuotedText>&gt; unrelated inode from the old one.</font><br>
<p>
That's correct.<br>
</p></div>

 <div class=CommentReplyButton>
 <form action=/Articles/810938/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>

 </p></details>
</details>
</div>
<div class="rightcol not-print">
<div id=azk93271_right_zone></div>
</div>
</div>
 <br clear=all>
 <center>
 <p>
 <span class=ReallySmall>
 Copyright © 2013, Eklektix, Inc.<br>
 This article may be redistributed under the terms of the
 <a href=http://creativecommons.org/licenses/by-sa/4.0/>Creative
 Commons CC BY-SA 4.0</a> license<br>
 Comments and public postings are copyrighted by their creators.<br>
 Linux is a registered trademark of Linus Torvalds<br>
 </span>
 </p></center>


<script data-template-shadow-root>(()=>{document.currentScript.remove();processNode(document);function processNode(node){node.querySelectorAll("template[shadowrootmode]").forEach(element=>{let shadowRoot = element.parentElement.shadowRoot;if (!shadowRoot) {try {shadowRoot=element.parentElement.attachShadow({mode:element.getAttribute("shadowrootmode")});shadowRoot.innerHTML=element.innerHTML;element.remove()} catch (error) {} if (shadowRoot) {processNode(shadowRoot)}}})}})()</script>
